import{r as k,a as g,h as d,s as p}from"./request-8HA-zsBu.js";import{a as I}from"./foods-lDgA2Xnc.js";import{_ as $}from"./NavBar-AT4074vg.js";import{o as L,c as i,a as e,b as z,F as b,r as v,l as m,e as A,g as h,j as n,n as R,t as r,k as N,m as S}from"./index-TxYDMVzU.js";function V(x){return k.post("/recipes/recommend",x)}function T(x,c){return k.post(`/recipes/${encodeURIComponent(x)}/complete`,c)}const B={class:"max-w-[480px] mx-auto min-h-screen min-h-[100dvh] flex flex-col bg-white shadow-sm relative"},U={class:"sticky top-0 z-50 safe-top bg-white/80 backdrop-blur-md px-4 py-3 flex items-center justify-between"},q={class:"flex gap-2.5 px-5 py-4 overflow-x-auto no-scrollbar"},D=["onClick"],E={class:"material-symbols-outlined text-[20px]"},M={class:"text-sm font-bold"},O={key:0,class:"material-symbols-outlined text-[18px]",style:{"font-variation-settings":"'FILL' 1"}},G={class:"flex flex-col gap-5 p-5 pb-32"},H={class:"absolute top-4 left-4 bg-primary text-white px-3.5 py-1.5 rounded-full text-xs font-bold flex items-center gap-1.5 shadow-lg shadow-primary/30"},J={class:"p-5 flex flex-col gap-4"},K={class:"text-slate-800 text-xl font-bold"},P={class:"flex gap-4 mt-2"},Q={class:"text-slate-500 text-xs font-bold flex items-center gap-1"},W={class:"text-slate-500 text-xs font-bold flex items-center gap-1"},X={class:"flex flex-col gap-1.5"},Y={class:"text-slate-500 text-sm leading-relaxed"},Z={class:"flex items-center justify-between pt-1"},ee={class:"flex -space-x-2.5"},te={class:"material-symbols-outlined text-[18px] text-primary"},se=["onClick"],le={key:1,class:"text-center text-slate-500 py-8"},re={__name:"AiFridgeClearingRecipes",setup(x){const c=h([]),a=h([]),u=h([]);function _(l){return{肉类:"restaurant",蔬菜:"nutrition",水果:"eco",奶制品:"local_drink",蛋白质:"egg",豆制品:"inventory_2"}[l]||"restaurant"}function j(l){const t=a.value.indexOf(l);t>-1?a.value.splice(t,1):a.value.push(l),f()}function C(){a.value.length===c.value.length?a.value=[]:a.value=c.value.map(l=>l.id),f()}async function w(){try{g("加载中...");const l=await I({status:"active"}),s=(Array.isArray(l==null?void 0:l.items)?l.items:[]).filter(o=>{const y=o.days_left??o.daysLeft??0;return y>=0&&y<=3});c.value=s,s.length>=2&&!a.value.length&&(a.value=s.slice(0,2).map(o=>o.id)),await f(),d()}catch{d(),p("加载失败","error")}}async function f(){if(!a.value.length){u.value=[];return}try{g("AI正在推荐菜谱...");const l=await V({mode:"manual",selectedFoodIds:a.value});u.value=(l==null?void 0:l.recipes)??[],d(),u.value.length&&p(`为您推荐了 ${u.value.length} 道菜`,"success")}catch{d(),p("加载菜谱失败","error")}}async function F(l){if(!a.value.length){p("请先选择食物","error");return}try{g("正在保存..."),await T(l,{foodIds:a.value}),d(),p("菜谱完成！食物已标记为已消费","success"),a.value=[],setTimeout(w,1500)}catch{d(),p("操作失败","error")}}return L(w),(l,t)=>(n(),i("div",B,[e("div",U,[e("button",{type:"button",class:"flex items-center justify-center w-10 h-10 -ml-2",onClick:t[0]||(t[0]=s=>l.$router.push("/"))},[...t[1]||(t[1]=[e("span",{class:"material-symbols-outlined text-[28px] text-slate-800"},"chevron_left",-1)])]),t[2]||(t[2]=z('<div class="flex flex-col items-center"><h2 class="text-slate-800 text-lg font-bold leading-tight">坏了么</h2><div class="flex items-center gap-1"><span class="size-1.5 rounded-full bg-primary"></span><p class="text-[10px] text-primary font-bold tracking-[0.05em]">AI 智能清库</p></div></div><div class="flex items-center justify-center w-10 h-10 -mr-2"><button class="flex size-9 items-center justify-center rounded-full bg-primary/10 text-primary"><span class="material-symbols-outlined text-[22px]">auto_fix_high</span></button></div>',2))]),e("div",{class:"px-5 pt-6 pb-2"},[e("div",{class:"flex justify-between items-center"},[t[3]||(t[3]=e("h3",{class:"text-slate-800 text-2xl font-bold tracking-tight"},"消灭库存大作战",-1)),e("button",{type:"button",class:"text-primary text-sm font-bold px-2 py-1",onClick:C},"全选")]),t[4]||(t[4]=e("p",{class:"text-slate-500 text-sm mt-1"},"选几个快坏掉的，AI 帮你变美味",-1))]),e("div",q,[(n(!0),i(b,null,v(c.value,s=>(n(),i("button",{key:s.id,class:R(["food-item flex h-11 shrink-0 items-center gap-x-2 rounded-2xl px-4 shadow-lg transition-transform active:scale-95 cursor-pointer",a.value.includes(s.id)?"bg-primary text-white":"bg-[#f8faf9] border border-gray-100 text-slate-500"]),type:"button",onClick:o=>j(s.id)},[e("span",E,r(_(s.category)),1),e("p",M,r(s.name)+" ("+r((s.days_left??s.daysLeft)===0?"今日到期":`${s.days_left??s.daysLeft}天后过期`)+")",1),a.value.includes(s.id)?(n(),i("span",O,"check_circle")):N("",!0)],10,D))),128))]),t[11]||(t[11]=e("div",{class:"px-5 pt-4 pb-2 flex items-center gap-2.5"},[e("div",{class:"size-8 rounded-lg bg-primary/10 flex items-center justify-center"},[e("span",{class:"material-symbols-outlined text-primary text-[20px]"},"temp_preferences_custom")]),e("h3",{class:"text-slate-800 text-lg font-bold"},"这几道菜最合适：")],-1)),e("div",G,[a.value.length?(n(!0),i(b,{key:0},v(u.value,s=>(n(),i("div",{key:s.id,class:"rounded-[2.5rem] overflow-hidden flex flex-col shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-white/60 bg-white/70 backdrop-blur"},[e("div",{class:"relative h-56 w-full bg-center bg-cover",style:S({backgroundImage:`url('${s.image_url||s.imageUrl||"https://via.placeholder.com/400"}')`})},[e("div",H,[t[5]||(t[5]=e("span",{class:"material-symbols-outlined text-[14px] font-bold"},"favorite",-1)),m(" 适配度 "+r(s.match_score??s.matchScore??90)+"% ",1)])],4),e("div",J,[e("div",null,[e("h4",K,r(s.title||s.name),1),e("div",P,[e("span",Q,[t[6]||(t[6]=e("span",{class:"material-symbols-outlined text-[16px] text-primary"},"schedule",-1)),m(" "+r(s.estimatedTime??s.cooking_time??30)+" 分钟 ",1)]),e("span",W,[t[7]||(t[7]=e("span",{class:"material-symbols-outlined text-[16px] text-primary"},"sentiment_satisfied",-1)),m(" "+r(s.difficulty||"简单易上手"),1)])])]),e("div",X,[t[8]||(t[8]=e("span",{class:"text-[11px] text-primary font-bold uppercase tracking-wider"},"还要准备：",-1)),e("p",Y,r(s.description||"库存食材即可"),1)]),e("div",Z,[e("div",ee,[(n(!0),i(b,null,v((s.ingredients||[]).slice(0,4),(o,y)=>(n(),i("div",{key:y,class:"w-9 h-9 rounded-full border-2 border-white bg-primary/20 flex items-center justify-center shadow-sm"},[e("span",te,r(_(typeof o=="object"?o.name:o)),1)]))),128))]),e("button",{type:"button",class:"bg-primary hover:bg-primary/90 text-white px-6 h-12 rounded-full text-sm font-bold flex items-center gap-2 shadow-lg shadow-primary/20 transition-all active:scale-95",onClick:o=>F(s.id)},[...t[9]||(t[9]=[e("span",{class:"material-symbols-outlined text-[20px]"},"check",-1),m(" 我做完了 ",-1)])],8,se)])])]))),128)):(n(),i("p",le,"请先选择食物"))]),e("div",{class:"fixed bottom-8 left-1/2 -translate-x-1/2 w-full max-w-[400px] px-6 z-40"},[e("button",{type:"button",class:"w-full bg-slate-800 text-white h-16 py-4 rounded-full font-bold shadow-2xl flex items-center justify-center gap-3 active:scale-95 transition-all",onClick:f},[...t[10]||(t[10]=[e("span",{class:"material-symbols-outlined text-primary"},"auto_awesome",-1),m(" 换一批灵感 ",-1)])])]),A($,{current:"recipes"})]))}};export{re as default};
