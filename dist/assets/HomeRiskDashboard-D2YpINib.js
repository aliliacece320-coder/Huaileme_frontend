import{w as N,o as T,c as i,a as t,b as V,d as B,v as H,t as l,F as h,r as y,e as v,f as I,g as p,h as _,i as U,u as q,j as c,n as d,k as R,l as G,m as k}from"./index-TxYDMVzU.js";import{s as g}from"./request-8HA-zsBu.js";import{g as X,a as w,b as K}from"./foods-lDgA2Xnc.js";import{_ as O}from"./NavBar-AT4074vg.js";const $={class:"min-h-screen min-h-[100dvh] pb-40 flex flex-col"},J={class:"sticky top-0 z-50 safe-top bg-white/60 backdrop-blur-xl border-b border-white/20"},W={class:"px-5 py-3 pt-0"},E={class:"relative flex items-center"},P={class:"px-5 py-4"},Q={class:"flex gap-4"},Z={class:"flex flex-1 flex-col gap-1 rounded-3xl p-5 bg-white/80 border border-slate-50 shadow-sm"},Y={class:"text-3xl font-black leading-tight mt-1 text-slate-900"},tt={class:"flex flex-1 flex-col gap-1 rounded-3xl p-5 bg-white/80 border border-slate-50 shadow-sm"},et={class:"text-3xl font-black leading-tight mt-1 text-slate-900"},st={class:"flex gap-3 px-5 py-2 overflow-x-auto no-scrollbar"},at=["onClick"],lt={class:"text-sm font-bold"},rt={class:"mt-6"},ot={class:"flex items-center justify-between px-6 mb-4"},nt={class:"space-y-4 px-5"},it=["onClick"],ct={class:"flex flex-col flex-1 justify-between py-1"},dt={class:"flex justify-between items-start"},ut={class:"font-bold text-base text-slate-900"},xt={class:"flex items-center gap-1.5 text-slate-400 text-xs mt-1.5"},pt={class:"font-bold"},mt={class:"mt-3"},bt={class:"flex justify-between items-end mb-1.5"},gt={class:"text-[10px] text-slate-400 font-black"},ft={class:"w-full bg-slate-100 h-2.5 rounded-full overflow-hidden"},ht={key:1,class:"text-center text-slate-400 py-8"},Lt={__name:"HomeRiskDashboard",setup(yt){const L=q(),u=p(""),x=p("全部物品"),m=p({urgentCount:0,goodCount:0}),o=p([]),C=[{key:"全部物品",label:"全部物品",icon:null},{key:"冷藏室",label:"冷藏室",icon:"kitchen"},{key:"储藏柜",label:"储藏柜",icon:"inventory_2"},{key:"冷冻室",label:"冷冻室",icon:"ac_unit"}],S=_(()=>m.value.urgentCount??0),j=_(()=>m.value.goodCount??0);function F(a){return{fridge:"冷藏室",freezer:"冷冻室",room:"储藏柜"}[a]||a||""}function n(a){const s=a.days_left??a.daysLeft??0,r=a.freshness_percentage??a.freshnessScore??0;return s<0||r<20?{text:"text-accent-coral",bg:"bg-accent-coral/15",bar:"bg-accent-coral",border:"border-l-[6px] border-l-accent-coral/60",textLabel:"快坏了！"}:s<3||r<50?{text:"text-orange-400",bg:"bg-orange-400/15",bar:"bg-orange-400",border:"",textLabel:"建议快吃"}:{text:"text-primary",bg:"bg-primary/15",bar:"bg-primary",border:"",textLabel:"挺新鲜的"}}function D(a){x.value=a.key,b()}async function A(){try{const a=await X();m.value={urgentCount:a.urgentCount??0,goodCount:a.goodCount??0,healthScore:a.healthScore??0,totalActive:a.totalActive??0}}catch(a){g("加载统计失败: "+(a.message||""),"error")}}async function b(){try{if(u.value.trim()){const e=await w({keyword:u.value.trim(),status:"active"});o.value=Array.isArray(e==null?void 0:e.items)?e.items:[];return}if(x.value==="全部物品"){const e=await K();o.value=(e==null?void 0:e.urgentItems)??[];return}const s={冷藏室:"fridge",冷冻室:"freezer",储藏柜:"room"}[x.value],r=await w({status:"active",storageStatus:s});o.value=Array.isArray(r==null?void 0:r.items)?r.items:[]}catch{g("加载失败","error"),o.value=[]}}function M(a){L.push({name:"ItemDetail",params:{id:String(a)}})}let f;return N(u,()=>{clearTimeout(f),f=setTimeout(b,300)}),T(async()=>{await A(),await b(),g("数据加载成功！","success")}),(a,s)=>{const r=U("router-link");return c(),i("div",$,[t("header",J,[s[2]||(s[2]=V('<div class="flex items-center p-5 pb-3 justify-between"><div class="flex size-11 shrink-0 items-center justify-center rounded-2xl bg-primary/20 text-primary"><span class="material-symbols-outlined font-bold text-2xl">eco</span></div><h2 class="text-2xl font-black flex-1 ml-4 text-slate-900 tracking-wide" style="font-family:ZCOOL KuaiLe, cursive;">快过期啦</h2><div class="flex gap-2"><div class="size-11 rounded-full bg-cover bg-center border-2 border-white shadow-md" style="background-image:url(&#39;https://lh3.googleusercontent.com/aida-public/AB6AXuDJA-qq50001FMFD4UAXt3BcLpC2G7NSWTHbtUIxJ6L8pBb8sZmzqUTnrsDk_jupjp_9HxpMSrmplXsL6Ci8gtGuJwGUrHR6qI0bCQEHJs8A2RckS0fqh_B35ftoUqK33aOD8clPw_412RnuX7-LhU-tV9y3SVx1m5HL5MWFMYN-dXduN6XR36bHKKQ5vg26Ljw-oEz43GqNitnjpFOHvWB2CCxSp9G3u5jxGPwxIsfTrVy1ONSL_Wxzu8DLg3c3SMSD_71hnm0Mv2L&#39;);"></div></div></div>',1)),t("div",W,[t("div",E,[s[1]||(s[1]=t("span",{class:"material-symbols-outlined absolute left-4 text-slate-400 text-xl"},"search",-1)),B(t("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>u.value=e),class:"w-full bg-slate-100/60 border-none rounded-2xl py-3 pl-11 pr-4 text-sm focus:ring-4 focus:ring-primary/10 placeholder:text-slate-400",placeholder:"找找冰箱里有什么？",type:"text"},null,512),[[H,u.value]])])])]),t("div",P,[t("div",Q,[t("div",Z,[s[3]||(s[3]=t("div",{class:"flex items-center gap-2"},[t("span",{class:"material-symbols-outlined text-accent-coral text-[20px]",style:{"font-variation-settings":"'FILL' 1"}},"warning"),t("p",{class:"text-accent-coral text-[11px] font-black tracking-widest"},"急需消灭")],-1)),t("p",Y,l(S.value),1),s[4]||(s[4]=t("p",{class:"text-slate-400 text-xs font-bold"},"件食物告急",-1))]),t("div",tt,[s[5]||(s[5]=t("div",{class:"flex items-center gap-2"},[t("span",{class:"material-symbols-outlined text-primary text-[20px]",style:{"font-variation-settings":"'FILL' 1"}},"check_circle"),t("p",{class:"text-primary text-[11px] font-black tracking-widest"},"状态新鲜")],-1)),t("p",et,l(j.value),1),s[6]||(s[6]=t("p",{class:"text-slate-400 text-xs font-bold"},"件还能再放放",-1))])])]),t("div",st,[(c(),i(h,null,y(C,e=>t("button",{key:e.key,class:d(["flex h-11 shrink-0 items-center justify-center gap-x-2 rounded-full px-5 transition-all",x.value===e.key?"bg-primary text-white shadow-lg shadow-primary/30":"bg-white border border-slate-100 shadow-sm text-slate-600"]),onClick:z=>D(e)},[e.icon?(c(),i("span",{key:0,class:d(["material-symbols-outlined text-[20px]",x.value===e.key?"text-white":"text-slate-400"])},l(e.icon),3)):R("",!0),t("p",lt,l(e.label),1)],10,at)),64))]),t("div",rt,[t("div",ot,[s[8]||(s[8]=t("h3",{class:"text-xl font-black tracking-tight text-slate-900"},"腐败风险提醒",-1)),v(r,{to:"/fridge",class:"text-primary text-sm font-bold bg-primary/10 px-3 py-1 rounded-full"},{default:I(()=>[...s[7]||(s[7]=[G("查看全部",-1)])]),_:1})]),t("div",nt,[o.value.length?(c(!0),i(h,{key:0},y(o.value,e=>(c(),i("div",{key:e.id,class:d(["rounded-3xl p-4 flex gap-4 cursor-pointer hover:scale-[1.02] transition-transform bg-white/70 backdrop-blur border",n(e).border]),onClick:z=>M(e.id)},[t("div",{class:"w-22 h-22 rounded-2xl bg-cover bg-center shrink-0 border border-white shadow-sm",style:k({backgroundImage:`url('${e.imageUrl||e.image_url||"https://via.placeholder.com/100"}')`})},null,4),t("div",ct,[t("div",null,[t("div",dt,[t("h4",ut,l(e.name),1),t("span",{class:d([n(e).text,"text-[10px] font-black px-2 py-0.5 rounded-lg",n(e).bg])},l(n(e).textLabel),3)]),t("div",xt,[s[9]||(s[9]=t("span",{class:"material-symbols-outlined text-[16px]"},"location_on",-1)),t("span",pt,l(F(e.storageStatus))+" • "+l(e.category||"未分类"),1)])]),t("div",mt,[t("div",bt,[t("span",{class:d(["text-sm font-black",n(e).text])},"还能放 "+l(Math.max(0,e.daysLeft??e.days_left??0))+" 天",3),t("span",gt,l(e.freshnessScore??e.freshness_percentage??0)+"% 新鲜度",1)]),t("div",ft,[t("div",{class:d(["h-full rounded-full",n(e).bar]),style:k({width:`${e.freshnessScore??e.freshness_percentage??0}%`})},null,6)])])])],10,it))),128)):(c(),i("p",ht,"暂无食物数据"))])]),v(O,{current:"home"})])}}};export{Lt as default};
