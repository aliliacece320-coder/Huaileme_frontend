import{o as U,c as h,a as e,t as d,p as $,m as D,b as T,l as C,y as B,g as L,h as m,u as M,j as w}from"./index-TxYDMVzU.js";import{c as R}from"./foods-lDgA2Xnc.js";import{r as _,s as l,a as v,h as u}from"./request-8HA-zsBu.js";function S(x){return _.post("/images/optimize",x)}function W(x,f){return _.post(`/food-actions/${encodeURIComponent(x)}`,f)}const P={class:"relative flex min-h-screen min-h-[100dvh] w-full flex-col overflow-x-hidden bg-white"},N={class:"fixed top-0 left-0 right-0 z-50 safe-top flex w-full items-center justify-between p-4"},Y={class:"text-slate-800 text-lg font-bold tracking-tight truncate max-w-[50vw]"},E={class:"relative h-[48vh] min-h-[200px] w-full bg-white"},O={class:"absolute bottom-6 left-4 right-4"},V={class:"bg-white/95 backdrop-blur-md flex items-center justify-between p-5 rounded-2xl shadow-xl border border-black/5"},Z={class:"flex flex-col"},q={class:"text-2xl font-extrabold mt-1 text-slate-800"},H={class:"relative flex items-center justify-center size-16"},J={class:"size-full -rotate-90"},K=["stroke-dashoffset"],Q={class:"absolute text-xs font-bold text-slate-800"},G={class:"flex-1 px-4 pb-44 bg-white rounded-t-[32px] -mt-4 relative z-10"},X={class:"grid grid-cols-2 gap-3 mt-8"},tt={class:"bg-[#F8FAF9] p-4 rounded-2xl border border-gray-100 shadow-sm"},et={class:"font-bold text-slate-800"},st={class:"bg-[#F8FAF9] p-4 rounded-2xl border border-gray-100 shadow-sm"},ot={class:"font-bold text-slate-800"},at={class:"mt-8"},rt={class:"bg-[#F8FAF9] p-6 rounded-2xl border border-gray-100 shadow-sm"},lt={class:"flex items-baseline gap-2 mb-4"},nt={class:"text-4xl font-extrabold text-slate-800 tracking-tighter"},it={class:"fixed bottom-0 left-0 right-0 p-6 pt-6 safe-inset-bottom bg-white/80 backdrop-blur-xl border-t border-gray-100 z-50"},dt={class:"flex gap-3"},xt={__name:"ItemDetailsActionScreen",setup(x){const f=B(),b=M(),p=f.params.id,o=L(null),g=m(()=>{var s,t;return((s=o.value)==null?void 0:s.freshnessScore)??((t=o.value)==null?void 0:t.freshness_percentage)??75}),k=m(()=>{var t,a,r,n;const s=((t=o.value)==null?void 0:t.daysLeft)??((a=o.value)==null?void 0:a.days_left);if(s==null){const c=((r=o.value)==null?void 0:r.expireDate)??((n=o.value)==null?void 0:n.expire_date);if(!c)return"还能陪你 -- 天";const i=Math.ceil((new Date(c)-new Date)/(1e3*60*60*24));return i<0?"已过期":i===0?"今日到期":`还能陪你 ${i} 天`}return s<0?"已过期":s===0?"今日到期":`还能陪你 ${s} 天`}),z=m(()=>{const s=2*Math.PI*28;return s-g.value/100*s}),F=m(()=>{var a,r;const s=((a=o.value)==null?void 0:a.storageStatus)??((r=o.value)==null?void 0:r.storage_location);return{fridge:"冷藏",freezer:"冷冻",room:"常温"}[s]||s||"冰箱 - 第一层"}),j=m(()=>{var a,r,n;const s=((a=o.value)==null?void 0:a.createdAt)??((r=o.value)==null?void 0:r.created_at)??((n=o.value)==null?void 0:n.added_date);if(!s)return"2023年10月24日";const t=new Date(s);return`${t.getFullYear()}年${t.getMonth()+1}月${t.getDate()}日`});async function A(){if(!p){l("食物ID不存在","error"),setTimeout(()=>b.push("/"),2e3);return}try{v("加载中..."),o.value=await R(p),u()}catch{u(),l("加载失败","error"),setTimeout(()=>b.push("/"),2e3)}}async function y(s){if(o.value&&!(s==="waste"&&!confirm("确定要扔掉这个食物吗？")))try{v("处理中..."),await W(p,{actionType:s==="consume"?"consume":"waste",score:s==="consume"?4:void 0,note:void 0}),u(),l(s==="consume"?"已标记为已消费！":"已标记为已浪费","success"),setTimeout(()=>b.push("/"),1500)}catch{u(),l("操作失败","error")}}async function I(){var s,t;if(!((s=o.value)!=null&&s.imageUrl)&&!((t=o.value)!=null&&t.image_url)){l("暂无可优化的图片","error");return}try{v("图片优化中...");const a=await S({imageUrl:o.value.image_url||o.value.imageUrl,foodId:p});u(),a!=null&&a.optimizedImageUrl?(o.value={...o.value,image_url:a.optimizedImageUrl,imageUrl:a.optimizedImageUrl},l("图片已优化","success")):l("未返回优化结果","info")}catch{u(),l("图片优化失败","error")}}return U(A),(s,t)=>{var a,r,n,c;return w(),h("div",P,[e("div",N,[e("button",{type:"button",class:"flex size-10 items-center justify-center rounded-full bg-white/85 backdrop-blur border border-black/5 shadow-sm",onClick:t[0]||(t[0]=i=>s.$router.push("/"))},[...t[4]||(t[4]=[e("span",{class:"material-symbols-outlined text-slate-800 text-[20px]"},"arrow_back_ios_new",-1)])]),e("h2",Y,d(((a=o.value)==null?void 0:a.name)||"宝贝详情"),1),e("button",{type:"button",class:"flex size-10 items-center justify-center rounded-full bg-white/85 backdrop-blur border border-black/5 shadow-sm",onClick:t[1]||(t[1]=i=>$(l)("更多功能开发中","info"))},[...t[5]||(t[5]=[e("span",{class:"material-symbols-outlined text-slate-800"},"more_horiz",-1)])])]),e("div",E,[e("div",{class:"h-full w-full bg-cover bg-center",style:D({backgroundImage:`url('${((r=o.value)==null?void 0:r.imageUrl)||((n=o.value)==null?void 0:n.image_url)||"https://lh3.googleusercontent.com/aida-public/AB6AXuBZiPWW4O7LNWoZmONFo2Ijs-fLb_M9doEJL3ccAYVMc4GQyXdvKAj2zgnYHM9vb72C_RIPa_Mjrdgj-h10GR5JmBf04_O34TsxAgTDErxpuFTsK-j87uKbAtyYitDWeFi-oPFQGWwUOpBXzelzK6IoRRZrdUT_yrLWvyhgSqz0NgcPWgP4H6VHg3xsMFSB3a9yHkZ2WmIYQExpx6g0YbtC-RoElW5zYlZR9Uq9aF6LoqTEvinS88jIPltNxAQsa8DUPbgJiJBAt64r"}')`})},null,4),t[8]||(t[8]=e("div",{class:"absolute inset-x-0 top-0 h-24 bg-gradient-to-b from-white/40 to-transparent"},null,-1)),e("div",O,[e("div",V,[e("div",Z,[t[6]||(t[6]=e("span",{class:"text-primary text-xs font-bold uppercase tracking-widest"},"时光在流逝",-1)),e("h1",q,d(k.value),1)]),e("div",H,[(w(),h("svg",J,[t[7]||(t[7]=e("circle",{class:"text-gray-100",cx:"32",cy:"32",fill:"transparent",r:"28",stroke:"currentColor","stroke-width":"5"},null,-1)),e("circle",{class:"text-primary",cx:"32",cy:"32",fill:"transparent",r:"28",stroke:"currentColor","stroke-dasharray":"175.9","stroke-dashoffset":z.value,"stroke-linecap":"round","stroke-width":"5"},null,8,K)])),e("span",Q,d(g.value)+"%",1)])])])]),e("div",G,[e("div",X,[e("div",tt,[t[9]||(t[9]=e("div",{class:"bg-primary/10 size-8 rounded-lg flex items-center justify-center mb-3 text-[#0ccb6d]"},[e("span",{class:"material-symbols-outlined text-xl"},"home_pin")],-1)),t[10]||(t[10]=e("p",{class:"text-slate-500 text-xs"},"它住在这里",-1)),e("p",et,d(F.value)+" - "+d(((c=o.value)==null?void 0:c.category)||"未分类"),1)]),e("div",st,[t[11]||(t[11]=e("div",{class:"bg-primary/10 size-8 rounded-lg flex items-center justify-center mb-3 text-[#0ccb6d]"},[e("span",{class:"material-symbols-outlined text-xl"},"favorite")],-1)),t[12]||(t[12]=e("p",{class:"text-slate-500 text-xs"},"相遇的日子",-1)),e("p",ot,d(j.value),1)])]),e("div",at,[t[14]||(t[14]=e("div",{class:"flex items-center justify-between mb-4"},[e("h3",{class:"text-slate-800 text-xl font-extrabold tracking-tight"},"宝贝新鲜度"),e("span",{class:"text-[#0ccb6d] text-[10px] font-bold bg-primary/10 px-2 py-1 rounded-full uppercase tracking-wider"},"小助手预测")],-1)),e("div",rt,[e("div",lt,[e("span",nt,d(g.value)+"%",1),t[13]||(t[13]=e("span",{class:"text-red-500 text-sm font-semibold"},"变淡了一点点",-1))])])])]),e("div",it,[t[18]||(t[18]=e("p",{class:"text-center text-[11px] font-bold text-slate-500 mb-4 tracking-[0.2em] uppercase"},"它的最后归宿",-1)),e("div",dt,[e("button",{type:"button",class:"flex-[1.2] bg-primary text-slate-800 h-14 rounded-2xl font-bold flex flex-col items-center justify-center transition-transform active:scale-95 shadow-lg shadow-primary/20",onClick:t[2]||(t[2]=i=>y("consume"))},[...t[15]||(t[15]=[T('<span class="flex items-center gap-2"><span class="material-symbols-outlined text-[20px] font-bold">celebration</span> 吃掉啦 </span><div class="flex items-center gap-1 mt-0.5"><span class="text-[9px] font-medium opacity-70">吃后感:</span><div class="flex gap-0.5"><span class="material-symbols-outlined text-[10px] fill-1 text-slate-800">star</span><span class="material-symbols-outlined text-[10px] fill-1 text-slate-800">star</span><span class="material-symbols-outlined text-[10px] fill-1 text-slate-800">star</span><span class="material-symbols-outlined text-[10px] fill-1 text-slate-800">star</span><span class="material-symbols-outlined text-[10px] fill-1 text-slate-800/20">star</span></div></div>',2)])]),e("button",{type:"button",class:"flex-1 border-2 border-gray-100 bg-white h-14 rounded-2xl font-bold flex items-center justify-center gap-2 text-red-400 active:bg-gray-50 transition-colors",onClick:t[3]||(t[3]=i=>y("waste"))},[...t[16]||(t[16]=[e("span",{class:"material-symbols-outlined text-red-400 text-[20px]"},"heart_broken",-1),C(" 忍痛扔掉 ",-1)])]),e("button",{type:"button",class:"size-14 bg-[#F8FAF9] border border-gray-100 rounded-2xl flex items-center justify-center text-slate-800 active:bg-gray-100",onClick:I},[...t[17]||(t[17]=[e("span",{class:"material-symbols-outlined"},"auto_fix_high",-1)])])])])])}}};export{xt as default};
