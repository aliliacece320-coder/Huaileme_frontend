import{r as N,s as f}from"./request-8HA-zsBu.js";import{_ as R}from"./NavBar-AT4074vg.js";import{o as T,c as n,a as t,p as W,m as g,t as d,b as z,F as b,r as w,l as V,e as A,g as y,j as r,n as h}from"./index-TxYDMVzU.js";function L(i){return N.get("/stats/foods/wasted-count",{params:i})}function P(i={}){return N.get("/stats/overview",{params:i})}async function Y(){const i=new Date,a=[];for(let l=5;l>=0;l--){const c=new Date(i.getFullYear(),i.getMonth()-l,1),m=c.getFullYear(),v=String(c.getMonth()+1).padStart(2,"0"),_=`${m}-${v}-01`,x=new Date(m,c.getMonth()+1,0),o=`${x.getFullYear()}-${String(x.getMonth()+1).padStart(2,"0")}-${String(x.getDate()).padStart(2,"0")}`,e=await L({from:_,to:o});a.push({month:`${c.getMonth()+1}月`,amount:(e==null?void 0:e.wastedCount)??0})}return a}const O={class:"bg-white min-h-screen min-h-[100dvh] font-display text-slate-800 flex flex-col"},q={class:"sticky top-0 z-50 safe-top bg-white/90 backdrop-blur-md px-4 py-4 flex items-center justify-between border-b border-slate-100"},E={class:"max-w-md mx-auto pb-32"},Z={class:"px-6 pt-10 pb-6 text-center"},G={class:"relative w-56 h-28 mx-auto mb-6 overflow-hidden"},H={class:"absolute bottom-0 left-0 right-0"},I={class:"text-5xl font-extrabold text-slate-900 leading-none"},J={class:"text-sm font-bold text-slate-400 block mt-1 tracking-tight"},K={class:"grid grid-cols-2 gap-4 px-4 py-2"},Q={class:"bg-white border border-slate-100 shadow-sm p-5 rounded-2xl"},U={class:"flex items-baseline gap-1"},X={class:"text-2xl font-bold text-[#FF6B6B]"},tt={class:"px-4 py-4"},et={class:"bg-white border border-slate-100 shadow-sm p-6 rounded-3xl"},st={class:"flex items-center gap-8"},ot={class:"relative w-32 h-32 flex items-center justify-center"},lt={class:"absolute inset-4 bg-white rounded-full flex flex-col items-center justify-center shadow-inner"},at={class:"text-2xl font-extrabold text-slate-900"},nt={class:"flex flex-col gap-5 flex-1"},rt={class:"flex items-center gap-3"},dt={class:"flex-1"},it={class:"text-xs text-slate-400 font-medium"},ct={class:"flex items-center gap-3"},ut={class:"flex-1"},xt={class:"text-xs text-slate-400 font-medium"},pt={class:"px-4 py-4"},mt={class:"bg-white border border-slate-100 shadow-sm p-6 rounded-3xl"},ft={class:"flex items-end justify-between h-36 gap-3 px-1"},gt={class:"flex justify-between mt-4 px-1"},bt={class:"py-6"},ht={class:"flex gap-4 overflow-x-auto px-5 no-scrollbar pb-4"},vt={class:"material-symbols-outlined !text-3xl"},_t={key:0,class:"text-[10px] text-[#20C997] font-bold mt-1.5 uppercase"},wt={key:0,class:"w-full h-1 bg-slate-100 rounded-full mt-2.5 overflow-hidden"},yt={key:1,class:"text-[10px] text-slate-400 mt-1.5 font-bold uppercase tracking-wider"},kt={class:"fixed bottom-24 left-0 right-0 px-6 max-w-md mx-auto z-40"},Ct={__name:"ZeroWasteStatisticsReport",setup(i){const a=y(null),l=y([]),c=y([]),m={fridge_guardian:"shield_with_heart",clearance_master:"psychology",food_hero:"eco",smart_shopper:"shopping_basket"};async function v(){try{const o=await P();a.value={eco_score:o.ecoScore??92,eco_level:o.ecoLevel??"环保小达人",total_consumed:o.totalConsumed??0,total_wasted:o.totalWasted??0,consumed_percentage:Math.round((o.cleanPlateRate??0)*100)||78,clean_plate_rate:o.cleanPlateRate},f("数据加载成功","success")}catch{f("加载统计失败","error")}}async function _(){try{l.value=await Y()}catch(o){console.warn(o)}}async function x(){try{const o=[{id:"fridge_guardian",name:"冰箱守护者",unlocked:!0,level:4},{id:"clearance_master",name:"清仓小能手",unlocked:!1,progress:30},{id:"food_hero",name:"节粮小英雄",unlocked:!0,level:2},{id:"smart_shopper",name:"精明小买手",unlocked:!1,progress:60}];c.value=o.map(e=>({...e,icon:m[e.id]||"star"}))}catch(o){console.warn(o)}}return T(()=>{v(),_(),x()}),(o,e)=>{var k,F,B,$,C,S,j,M,D;return r(),n("div",O,[t("nav",q,[t("button",{type:"button",class:"w-10 h-10 flex items-center justify-center rounded-full active:bg-slate-100 transition-colors",onClick:e[0]||(e[0]=s=>o.$router.push("/"))},[...e[3]||(e[3]=[t("span",{class:"material-symbols-outlined text-slate-700"},"arrow_back_ios_new",-1)])]),e[5]||(e[5]=t("h1",{class:"text-[19px] font-bold tracking-normal"},"我的零浪费记录",-1)),t("button",{type:"button",class:"w-10 h-10 flex items-center justify-center rounded-full active:bg-slate-100 transition-colors",onClick:e[1]||(e[1]=s=>W(f)("日历筛选开发中","info"))},[...e[4]||(e[4]=[t("span",{class:"material-symbols-outlined text-slate-700"},"calendar_today",-1)])])]),t("main",E,[t("section",Z,[t("div",G,[e[6]||(e[6]=t("div",{class:"absolute inset-0 border-[16px] border-slate-100 rounded-t-full"},null,-1)),t("div",{class:"absolute inset-0 border-[16px] border-primary rounded-t-full",style:g({clipPath:"inset(0 0 0 0)",transform:`rotate(${165+(((k=a.value)==null?void 0:k.eco_score)??92)*1.5}deg)`,transformOrigin:"center bottom"})},null,4),t("div",H,[t("span",I,d(((F=a.value)==null?void 0:F.eco_score)??92),1),t("span",J,d(((B=a.value)==null?void 0:B.eco_level)||"环保小达人"),1)])]),e[7]||(e[7]=t("h2",{class:"text-2xl font-black text-slate-900 tracking-tight mb-2"},"简直太棒啦！",-1)),e[8]||(e[8]=t("p",{class:"text-slate-500 text-sm font-medium"},"这个月你打败了 95% 的小伙伴哦。",-1))]),t("section",K,[e[11]||(e[11]=z('<div class="bg-white border border-slate-100 shadow-sm p-5 rounded-2xl"><p class="text-xs font-bold text-slate-400 tracking-tight mb-1">省下了这么多</p><div class="flex items-baseline gap-1"><span class="text-2xl font-bold text-[#20C997]">¥845</span><span class="text-[11px] font-bold text-[#20C997] bg-[#20C997]/10 px-1.5 py-0.5 rounded">+12%</span></div></div>',1)),t("div",Q,[e[10]||(e[10]=t("p",{class:"text-xs font-bold text-slate-400 tracking-tight mb-1"},"不小心浪费了",-1)),t("div",U,[t("span",X,d((($=a.value)==null?void 0:$.total_wasted)??0)+" 件",1),e[9]||(e[9]=t("span",{class:"text-[11px] font-bold text-[#FF6B6B] bg-[#FF6B6B]/10 px-1.5 py-0.5 rounded"},"-2%",-1))])])]),t("section",tt,[t("div",et,[e[17]||(e[17]=t("h3",{class:"text-lg font-bold text-slate-900 mb-6"},"吃掉了 vs 扔掉了",-1)),t("div",st,[t("div",ot,[t("div",{class:"absolute inset-0 rounded-full border-[16px] border-transparent",style:g({background:`conic-gradient(#00D1A0 0% ${((C=a.value)==null?void 0:C.consumed_percentage)??78}%, #FF6B6B ${((S=a.value)==null?void 0:S.consumed_percentage)??78}% 100%)`,borderRadius:"50%"})},null,4),t("div",lt,[t("span",at,d(((j=a.value)==null?void 0:j.consumed_percentage)??78)+"%",1),e[12]||(e[12]=t("span",{class:"text-[10px] font-bold text-slate-400 tracking-tighter"},"光盘啦",-1))])]),t("div",nt,[t("div",rt,[e[14]||(e[14]=t("div",{class:"w-3.5 h-3.5 rounded-full bg-primary shadow-sm shadow-primary/40"},null,-1)),t("div",dt,[e[13]||(e[13]=t("p",{class:"text-sm font-bold leading-none text-slate-800"},"进肚子的",-1)),t("p",it,d(((M=a.value)==null?void 0:M.total_consumed)??0)+" 件食材",1)])]),t("div",ct,[e[16]||(e[16]=t("div",{class:"w-3.5 h-3.5 rounded-full bg-[#FF6B6B] shadow-sm shadow-[#FF6B6B]/40"},null,-1)),t("div",ut,[e[15]||(e[15]=t("p",{class:"text-sm font-bold leading-none text-slate-800"},"扔掉的",-1)),t("p",xt,d(((D=a.value)==null?void 0:D.total_wasted)??0)+" 件过期",1)])])])])])]),t("section",pt,[t("div",mt,[e[18]||(e[18]=z('<div class="flex justify-between items-start mb-8"><div><h3 class="text-lg font-bold text-slate-900">钱包心疼指数</h3><p class="text-sm text-slate-400 font-medium">最近浪费的钱</p></div><div class="text-right"><span class="text-[#FF6B6B] font-extrabold text-2xl">¥286.50</span></div></div>',1)),t("div",ft,[(r(!0),n(b,null,w(l.value.length?l.value:[...Array(6)].map((s,u)=>({month:`${u+5}月`,amount:3+u*2})),(s,u)=>(r(),n("div",{key:u,class:"flex-1 bg-slate-50 rounded-t-xl relative h-full"},[t("div",{class:h(["absolute bottom-0 left-0 right-0 rounded-t-xl transition-all",s.amount/Math.max(...(l.value.length?l.value:[{amount:1}]).map(p=>p.amount),1)>.8?"bg-[#FF6B6B] shadow-lg shadow-[#FF6B6B]/20":s.amount/Math.max(...(l.value.length?l.value:[{amount:1}]).map(p=>p.amount),1)>.5?"bg-[#FF6B6B]/60":"bg-[#FF6B6B]/40"]),style:g({height:`${s.amount/Math.max(...(l.value.length?l.value:[{amount:1}]).map(p=>p.amount),1)*100}%`})},null,6)]))),128))]),t("div",gt,[(r(!0),n(b,null,w(l.value.length?l.value:[...Array(6)],(s,u)=>(r(),n("span",{key:u,class:"text-[10px] font-bold text-slate-400"},d(typeof s=="object"&&s.month?s.month.replace("月",""):["5","6","7","8","9","10"][u])+"月 ",1))),128))])])]),t("section",bt,[e[19]||(e[19]=t("h3",{class:"text-lg font-bold px-5 mb-4 text-slate-900"},"我的荣誉勋章",-1)),t("div",ht,[(r(!0),n(b,null,w(c.value,s=>(r(),n("div",{key:s.id,class:h(["flex-shrink-0 w-32 p-5 rounded-3xl flex flex-col items-center text-center shadow-sm",s.unlocked?"bg-[#20C997]/5 border border-[#20C997]/10":"bg-white border border-slate-100"])},[t("div",{class:h(["w-14 h-14 rounded-full flex items-center justify-center mb-4",s.unlocked?"bg-[#20C997] text-white shadow-lg shadow-[#20C997]/30":"bg-slate-100 text-slate-400"])},[t("span",vt,d(s.icon),1)],2),t("p",{class:h(["text-sm font-bold leading-tight",s.unlocked?"text-slate-900":"text-slate-500"])},d(s.name),3),s.unlocked?(r(),n("p",_t,"Lvl. "+d(s.level),1)):(r(),n(b,{key:1},[s.progress!=null?(r(),n("div",wt,[t("div",{class:"bg-primary h-full",style:g({width:`${s.progress}%`})},null,4)])):(r(),n("p",yt,"未解锁"))],64))],2))),128))])])]),t("div",kt,[t("button",{type:"button",class:"w-full bg-primary text-white font-extrabold py-4 rounded-2xl shadow-xl shadow-primary/20 active:scale-[0.98] transition-all flex items-center justify-center gap-2",onClick:e[2]||(e[2]=s=>W(f)("分享功能开发中...","info"))},[...e[20]||(e[20]=[t("span",{class:"material-symbols-outlined"},"share",-1),V(" 把好成绩分享给朋友 ",-1)])])]),A(R,{current:"stats"})])}}};export{Ct as default};
