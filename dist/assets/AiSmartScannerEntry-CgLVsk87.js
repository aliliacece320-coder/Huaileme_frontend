import{o as U,c as h,a as e,e as R,f as Z,t as d,p as E,F as O,r as N,l as X,i as $,h as w,g as p,u as q,j as _,n as M,m as V}from"./index-TxYDMVzU.js";import{r as S,s as o,a as x,h as u}from"./request-8HA-zsBu.js";function k(f){return S.post("/scan/recognize",f)}function W(f){return S.post("/scan/save",f)}const J={class:"bg-[#f6f8f7] min-h-screen min-h-[100dvh] flex flex-col"},K={class:"relative z-50 safe-top flex items-center bg-transparent p-4 pb-2 justify-between"},G={class:"relative flex-1 flex flex-col items-center justify-center overflow-hidden"},P={class:"absolute inset-0 z-0"},Q={class:"relative z-10 flex flex-col items-center"},H={class:"mt-8 flex gap-3 p-1"},ee={class:"flex h-12 shrink-0 items-center justify-center gap-x-2 rounded-2xl bg-white/80 backdrop-blur-md px-5 border border-white/50 shadow-xl"},te={class:"text-slate-900 text-base font-bold"},se={class:"relative z-10 flex items-center justify-center gap-8 p-4 pb-6"},ae={class:"relative z-[60] flex flex-col justify-end items-stretch"},le={class:"flex flex-col items-stretch bg-white/80 backdrop-blur-2xl rounded-t-[40px] border-t border-white/60 pb-10 px-6 safe-inset-bottom shadow-[0_-10px_40px_rgba(0,0,0,0.05)]"},re={class:"space-y-6 pt-2"},oe={class:"flex items-center justify-between"},ne={class:"flex items-center gap-2"},ie={class:"text-2xl font-bold text-slate-900 tracking-tight"},de={class:"grid grid-cols-2 gap-4"},ue={class:"bg-slate-50/80 p-4 rounded-[24px] border border-slate-100"},ce={class:"text-lg font-bold text-slate-900"},fe={class:"bg-primary/5 p-4 rounded-[24px] border border-primary/10"},pe={class:"text-lg font-bold text-slate-900"},be={class:"flex gap-2"},me=["onClick"],xe={class:"text-[11px] font-bold"},j="https://via.placeholder.com/800x600.png?text=Bad%E4%BA%86%E5%90%97+-+Image+Unavailable",ye={__name:"AiSmartScannerEntry",setup(f){const z=q(),g=p(null),a=p(null),i=p(!1),c=p("fridge"),B={fontVariationSettings:"'FILL' 1"},C=[{value:"room",label:"常温",icon:"thermostat"},{value:"fridge",label:"冷藏",icon:"kitchen"},{value:"freezer",label:"冷冻",icon:"ac_unit"}];function D(s){s!=null&&s.target&&s.target.src!==j&&(s.target.src=j)}const v=w(()=>{var t,r;const s=((t=a.value)==null?void 0:t.expireDate)||((r=a.value)==null?void 0:r.expiry_date);return s?s.replace(/-/g,"/"):"2026/05/20"}),L=w(()=>{var r,n;const s=((r=a.value)==null?void 0:r.expireDate)||((n=a.value)==null?void 0:n.expiry_date);if(!s)return"-- 天";const t=Math.ceil((new Date(s)-new Date)/(1e3*60*60*24));return`${Math.max(0,t)} 天`});function F(){var s;(s=g.value)==null||s.click()}function I(s){var n;const t=(n=s.target.files)==null?void 0:n[0];if(!t||!t.type.startsWith("image/"))return;const r=new FileReader;r.onload=async()=>{const l=r.result,m=typeof l=="string"&&l.startsWith("data:")?l.split(",")[1]:l;if(m)try{x("正在识别...");const y=await k({imageBase64:`data:${t.type};base64,${m}`,storageStatus:c.value});a.value=y,u(),o("识别成功！","success")}catch{u(),o("识别失败，请重试","error")}},r.readAsDataURL(t),s.target.value=""}async function b(){try{x("正在识别...");const s=await k({imageUrl:""});a.value=s,u(),o("识别成功！","success")}catch{u(),o("识别失败，请重试","error")}}function Y(){i.value||(i.value=!0,o("请将摄像头对准食物","info"),setTimeout(async()=>{await b(),i.value=!1},2e3))}function A(){i.value||(i.value=!0,o("请扫描条形码","info"),setTimeout(async()=>{await b(),i.value=!1},1500))}async function T(){if(!a.value){o("请先识别食物","error");return}try{x("正在保存..."),await W({name:a.value.name,expireDate:a.value.expireDate||a.value.expiry_date,storageStatus:c.value,brand:a.value.brand||"",category:a.value.category||"",imageUrl:a.value.image_url||a.value.imageUrl||""}),u(),o("保存成功！","success"),setTimeout(()=>z.push("/"),1500)}catch{u(),o("保存失败，请重试","error")}}return U(()=>{b()}),(s,t)=>{var n;const r=$("router-link");return _(),h("div",J,[e("div",K,[R(r,{to:"/",class:"text-slate-900 flex size-12 shrink-0 items-center"},{default:Z(()=>[...t[1]||(t[1]=[e("div",{class:"p-2 rounded-full bg-white/60 backdrop-blur-md"},[e("span",{class:"material-symbols-outlined cursor-pointer"},"close")],-1)])]),_:1}),t[2]||(t[2]=e("h2",{class:"text-slate-900 text-lg font-bold leading-tight tracking-tight flex-1 text-center"},"AI 智能扫码录入",-1)),t[3]||(t[3]=e("div",{class:"flex w-12 items-center justify-end"},[e("button",{class:"flex size-12 items-center justify-center rounded-full bg-white/60 backdrop-blur-md text-slate-900 shadow-sm"},[e("span",{class:"material-symbols-outlined"},"flashlight_on")])],-1))]),e("div",G,[e("div",P,[e("img",{alt:"食品保质期扫描",class:"w-full h-full object-cover contrast-[1.05]",src:"https://lh3.googleusercontent.com/aida-public/AB6AXuArYRimNecEj3W2aQgoRRC-kbu1-xklMJZm8nvkkXuf5X7A-K3ctvw4DnZ28L6vuTwFvfZc9s7gYcN0ZhOXYuZ4_91qzytjaiIZSj_crseLgipozF8itBSa6upkCACsmvASvljuX9xzm670dLtNdShuC2aYbcIYd4vXTTay68lZxB03jsGYIYm1YPYkBJW2gOdau5_cmbUoqxj0COSDOaUeuRBBvoBOYgA4tYvuDh4qp-OYT_orfirnU1LwSeD9h1l9Jsux25fZ_nUK",onError:D},null,32),t[4]||(t[4]=e("div",{class:"absolute inset-0 bg-[radial-gradient(circle, transparent 40%, rgba(255,255,255,0.4) 100%)]"},null,-1))]),e("div",Q,[t[6]||(t[6]=e("div",{class:"w-48 h-48 border-4 border-primary rounded-full flex items-center justify-center relative shadow-[0_0_20px_2px_rgba(19,236,128,0.4)]"},[e("div",{class:"absolute inset-0 border border-primary/40 rounded-full scale-110"})],-1)),e("div",H,[e("div",ee,[t[5]||(t[5]=e("span",{class:"material-symbols-outlined text-primary font-bold"},"verified",-1)),e("p",te,"发现日期："+d(v.value),1)])]),t[7]||(t[7]=e("p",{class:"text-slate-700 text-sm font-semibold mt-4 bg-white/60 backdrop-blur-md px-6 py-2 rounded-full border border-white/40 shadow-sm"}," 请将保质期对准圆圈中心 ",-1))])]),e("div",se,[e("input",{ref_key:"fileInputRef",ref:g,type:"file",accept:"image/*",class:"hidden",onChange:I},null,544),e("button",{type:"button",class:"flex shrink-0 items-center justify-center rounded-full size-12 bg-white/60 backdrop-blur-md text-slate-700 border border-white/50",onClick:F},[...t[8]||(t[8]=[e("span",{class:"material-symbols-outlined"},"image",-1)])]),e("button",{type:"button",class:"flex shrink-0 items-center justify-center rounded-full size-20 bg-primary/20 border-4 border-white/80 p-1 shadow-lg",onClick:Y},[...t[9]||(t[9]=[e("div",{class:"bg-primary rounded-full w-full h-full flex items-center justify-center shadow-inner"},[e("span",{class:"material-symbols-outlined text-white font-bold text-3xl"},"camera")],-1)])]),e("button",{type:"button",class:"flex shrink-0 items-center justify-center rounded-full size-12 bg-white/60 backdrop-blur-md text-slate-700 border border-white/50",onClick:A},[...t[10]||(t[10]=[e("span",{class:"material-symbols-outlined"},"barcode_scanner",-1)])])]),e("div",ae,[e("div",le,[t[18]||(t[18]=e("div",{class:"flex h-10 w-full items-center justify-center"},[e("div",{class:"h-1.5 w-14 rounded-full bg-slate-200"})],-1)),e("div",re,[e("div",oe,[e("div",null,[t[12]||(t[12]=e("h3",{class:"text-[11px] font-extrabold text-primary uppercase tracking-widest mb-1"},"这是什么？",-1)),e("div",ne,[t[11]||(t[11]=e("span",{class:"material-symbols-outlined text-primary",style:{"font-variation-settings":"'FILL' 1"}},"lunch_dining",-1)),e("span",ie,d(((n=a.value)==null?void 0:n.name)||"希腊酸奶 - 有机"),1)])]),e("button",{type:"button",class:"p-2.5 rounded-2xl bg-slate-100/80 text-slate-500 border border-slate-200/50",onClick:t[0]||(t[0]=l=>E(o)("编辑功能开发中","info"))},[...t[13]||(t[13]=[e("span",{class:"material-symbols-outlined text-xl"},"edit_note",-1)])])]),e("div",de,[e("div",ue,[t[14]||(t[14]=e("p",{class:"text-[11px] text-slate-400 font-bold mb-1 tracking-wider"},"啥时候过期？",-1)),e("p",ce,d(v.value),1)]),e("div",fe,[t[15]||(t[15]=e("p",{class:"text-[11px] text-primary/70 font-bold mb-1 tracking-wider"},"还能吃多久",-1)),e("p",pe,d(L.value),1)])]),e("div",null,[t[16]||(t[16]=e("p",{class:"text-[11px] text-slate-400 font-bold mb-3 tracking-wider"},"住哪儿？（常温/冷藏/冷冻）",-1)),e("div",be,[(_(),h(O,null,N(C,l=>e("button",{key:l.value,class:M(["flex-1 flex flex-col items-center justify-center gap-1.5 p-3.5 rounded-[22px] border",c.value===l.value?"border-2 border-primary bg-primary text-white shadow-lg shadow-primary/20":"border-slate-200 bg-white text-slate-400"]),onClick:m=>c.value=l.value},[e("span",{class:"material-symbols-outlined",style:V(c.value===l.value?B:{})},d(l.icon),5),e("span",xe,d(l.label),1)],10,me)),64))])]),e("button",{type:"button",class:"w-full h-15 py-4 bg-primary text-white font-bold text-lg rounded-[22px] flex items-center justify-center gap-3 shadow-xl shadow-primary/25 active:scale-95 transition-transform",onClick:T},[...t[17]||(t[17]=[e("span",{class:"material-symbols-outlined font-bold"},"save_as",-1),X(" 记下来 ",-1)])])])])])])}}};export{ye as default};
