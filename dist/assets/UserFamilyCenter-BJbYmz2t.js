import{g as b,o as $,c as l,a as e,t as p,q as T,d as w,v as h,l as v,k as B,e as E,u as P,j as n}from"./index-TxYDMVzU.js";import{T as f,b as q,r as g,s as r}from"./request-8HA-zsBu.js";import{_ as O}from"./NavBar-AT4074vg.js";const R="/api";async function k(u,d,s){const m={"Content-Type":"application/json"},c=localStorage.getItem(f);c&&(m.Authorization=`Bearer ${c}`);const{data:a}=await q.request({baseURL:R,url:d,method:u,data:s,headers:m});if(!a||typeof a!="object")throw new Error("无效的响应格式");if(a.code!=="000")throw new Error(a.msg||`业务错误 ${a.code}`);return a.data}async function M(u,d){const s=await k("POST","/auth/register",{username:u,password:d});return s!=null&&s.token&&localStorage.setItem(f,s.token),s}async function z(u,d){const s=await k("POST","/auth/login",{username:u,password:d});return s!=null&&s.token&&localStorage.setItem(f,s.token),s}async function A(){try{await k("POST","/auth/logout")}finally{localStorage.removeItem(f)}}function K(){return g.get("/user/profile")}function L(){return g.get("/family")}function Y(u){return g.post("/family/join",{familyId:u})}function G(){return g.post("/family/leave")}const H={class:"max-w-md mx-auto min-h-screen min-h-[100dvh] flex flex-col"},J={class:"flex-1 px-5 py-4 pb-28 space-y-5"},Q={class:"bg-white/90 rounded-3xl border border-slate-100 shadow-sm p-4 space-y-3"},W={class:"flex items-center justify-between"},X={key:0,class:"mt-1 text-base font-bold"},Z={key:1,class:"mt-1 text-base font-bold"},ee={key:0,class:"material-symbols-outlined text-primary text-2xl"},te={key:1,class:"material-symbols-outlined text-slate-300 text-2xl"},se={key:1,class:"mt-3 flex items-center justify-between"},ae={class:"text-xs text-slate-500"},oe={class:"mt-0.5"},le={class:"bg-white/90 rounded-3xl border border-slate-100 shadow-sm p-4 space-y-3"},ne={class:"flex items-center justify-between mb-1"},re={key:0,class:"mt-1 text-base font-bold"},ie={key:1,class:"mt-1 text-base font-bold"},ue={key:0,class:"text-xs text-slate-500 space-y-1"},de={key:2,class:"text-xs text-slate-400"},fe={__name:"UserFamilyCenter",setup(u){const d=P(),s=b({username:"",password:""}),m=b({familyId:""}),c=b(null),a=b(null),i=b(!!(typeof localStorage<"u"&&localStorage.getItem(f)));async function y(){if(i.value){try{c.value=await K()}catch(o){console.warn(o)}try{a.value=await L()}catch(o){console.warn(o)}}}async function C(){if(!s.value.username||!s.value.password){r("请输入用户名和密码","error");return}try{await z(s.value.username,s.value.password),i.value=!0,r("登录成功","success"),await y()}catch(o){r(o.message||"登录失败","error")}}async function F(){if(!s.value.username||!s.value.password){r("请输入用户名和密码","error");return}try{await M(s.value.username,s.value.password),i.value=!0,r("注册并登录成功","success"),await y()}catch(o){r(o.message||"注册失败","error")}}async function V(){await A(),i.value=!1,c.value=null,a.value=null,r("已退出登录","success")}async function D(){if(!m.value.familyId){r("请填写家庭ID","error");return}try{await Y(m.value.familyId),r("加入家庭成功","success"),await y()}catch(o){r(o.message||"加入家庭失败","error")}}async function N(){try{await G(),r("已退出当前家庭","success"),await y()}catch(o){r(o.message||"操作失败","error")}}function U(){window.history.length>1?d.back():d.push("/")}return $(()=>{i.value=!!(typeof localStorage<"u"&&localStorage.getItem(f)),y()}),(o,t)=>{var _,j,I,S;return n(),l("div",H,[e("header",{class:"sticky top-0 z-50 safe-top bg-white/80 backdrop-blur-md border-b border-slate-100 px-5 py-4 flex items-center justify-between"},[e("button",{class:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-slate-100",onClick:U},[...t[4]||(t[4]=[e("span",{class:"material-symbols-outlined text-slate-600"},"arrow_back_ios_new",-1)])]),t[5]||(t[5]=e("h1",{class:"text-lg font-black tracking-tight"},"我的账号与家庭",-1)),t[6]||(t[6]=e("div",{class:"w-10 h-10"},null,-1))]),e("main",J,[e("section",Q,[e("div",W,[e("div",null,[t[7]||(t[7]=e("p",{class:"text-xs font-bold text-slate-400 tracking-widest"},"登录状态",-1)),i.value?(n(),l("p",X,"已登录："+p((_=c.value)==null?void 0:_.username),1)):(n(),l("p",Z,"当前未登录"))]),i.value?(n(),l("span",ee,"verified_user")):(n(),l("span",te,"lock_open"))]),i.value?(n(),l("div",se,[e("div",ae,[e("p",null,"昵称："+p(((j=c.value)==null?void 0:j.displayName)||"未设置"),1),e("p",oe,"用户 ID："+p((I=c.value)==null?void 0:I.id),1)]),e("button",{class:"h-9 px-4 rounded-full border border-slate-200 text-xs font-bold text-slate-500",onClick:V},"退出登录")])):(n(),l("form",{key:0,class:"grid grid-cols-2 gap-2 mt-2",onSubmit:t[2]||(t[2]=T(()=>{},["prevent"]))},[w(e("input",{"onUpdate:modelValue":t[0]||(t[0]=x=>s.value.username=x),type:"text",placeholder:"用户名",class:"col-span-2 text-sm rounded-2xl border border-slate-200 px-4 py-2"},null,512),[[h,s.value.username]]),w(e("input",{"onUpdate:modelValue":t[1]||(t[1]=x=>s.value.password=x),type:"password",placeholder:"密码",class:"col-span-2 text-sm rounded-2xl border border-slate-200 px-4 py-2"},null,512),[[h,s.value.password]]),e("button",{type:"button",class:"col-span-1 h-10 rounded-2xl bg-primary text-white text-sm font-bold flex items-center justify-center gap-1",onClick:C},[...t[8]||(t[8]=[e("span",{class:"material-symbols-outlined text-base"},"login",-1),v(" 登录 ",-1)])]),e("button",{type:"button",class:"col-span-1 h-10 rounded-2xl bg-slate-900 text-white text-sm font-bold flex items-center justify-center gap-1",onClick:F},[...t[9]||(t[9]=[e("span",{class:"material-symbols-outlined text-base"},"person_add",-1),v(" 注册 ",-1)])])],32))]),e("section",le,[e("div",ne,[e("div",null,[t[10]||(t[10]=e("p",{class:"text-xs font-bold text-slate-400 tracking-widest"},"当前家庭",-1)),a.value?(n(),l("p",re,"「"+p(a.value.name)+"」",1)):(n(),l("p",ie,"暂无家庭信息"))]),t[11]||(t[11]=e("span",{class:"material-symbols-outlined text-primary text-2xl"},"diversity_2",-1))]),a.value?(n(),l("div",ue,[e("p",null,"家庭 ID："+p(a.value.id),1),e("p",null,"成员："+p(((S=a.value.members)==null?void 0:S.length)||0)+" 人",1)])):B("",!0),i.value?(n(),l("form",{key:1,class:"mt-3 grid grid-cols-2 gap-2",onSubmit:T(D,["prevent"])},[w(e("input",{"onUpdate:modelValue":t[3]||(t[3]=x=>m.value.familyId=x),type:"number",placeholder:"输入家庭ID加入",class:"text-xs rounded-2xl border border-slate-200 px-4 py-2 col-span-2"},null,512),[[h,m.value.familyId,void 0,{number:!0}]]),t[13]||(t[13]=e("button",{type:"submit",class:"h-9 rounded-2xl bg-primary text-white text-xs font-bold flex items-center justify-center gap-1"},[e("span",{class:"material-symbols-outlined text-sm"},"meeting_room"),v(" 加入家庭 ")],-1)),e("button",{type:"button",class:"h-9 rounded-2xl border border-slate-200 text-xs font-bold text-slate-500 flex items-center justify-center gap-1",onClick:N},[...t[12]||(t[12]=[e("span",{class:"material-symbols-outlined text-sm"},"logout",-1),v(" 退出当前家庭 ",-1)])])],32)):(n(),l("p",de,"登录后可查看和管理家庭信息。"))])]),E(O,{current:"family"})])}}};export{fe as default};
