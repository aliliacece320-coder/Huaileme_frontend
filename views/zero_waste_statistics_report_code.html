<!DOCTYPE html>
<html lang="zh-CN"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&amp;family=Noto+Sans+SC:wght@400;500;700;900&amp;family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;family=Ma+Shan+Zheng&amp;family=ZCOOL+KuaiLe&amp;display=swap" rel="stylesheet"/>
<script id="tailwind-config">
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        "primary": "#00D1A0", // Mint
                        "coral": "#FF6B6B",   // Coral
                        "teal": "#20C997",    // Teal
                        "background": "#FFFFFF",
                        "card-bg": "#FFFFFF",
                    },
                    fontFamily: {
                        "display": ["'ZCOOL KuaiLe'", "'Quicksand'", "'Noto Sans SC'", "sans-serif"],
                        "body": ["'Quicksand'", "'Noto Sans SC'", "sans-serif"]
                    },
                    borderRadius: { "DEFAULT": "0.5rem", "lg": "1rem", "xl": "1.5rem", "2xl": "2rem", "full": "9999px" },
                },
            },
        }
    </script>
<style type="text/tailwindcss">
        :root {
            --mint: #00D1A0;
            --coral: #FF6B6B;
            --teal: #20C997;
        }* {
            font-family: 'ZCOOL KuaiLe', 'Noto Sans SC', sans-serif;
            letter-spacing: -0.01em;
        }
        .chart-ring {
            background: conic-gradient(var(--mint) 0% 78%, var(--coral) 78% 100%);
            border-radius: 50%;
        }
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        body {
            background-color: #FFFFFF;
        }
    </style>
<style>
        body {
            min-height: max(884px, 100dvh);
        }
        .font-variation-fill {
            font-variation-settings: 'FILL' 1;
        }
    </style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
  </head>
<body class="bg-background text-slate-800 min-h-screen font-display">
<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
<script src="/public/api-client.js"></script>
<script>
const { createApp, ref, onMounted } = Vue;

createApp({
  setup() {
    const stats = ref(null);
    const trend = ref([]);
    const badges = ref([]);

    const loadStats = async () => {
      try {
        const s = await ApiClient.getStatsOverview();
        stats.value = s;

        document.querySelector('.text-5xl').textContent =
          s.eco_score ?? 92;
        document.querySelector('.text-sm.block').textContent =
          s.eco_level || '环保小达人';

        const consumedEl = Array.from(
          document.querySelectorAll('span'),
        ).find((sp) => sp.textContent.includes('78%'));
        if (consumedEl) {
          consumedEl.textContent = `${s.consumed_percentage ?? 0}%`;
        }

        const consumedCountEl = Array.from(
          document.querySelectorAll('p'),
        ).find((p) => p.textContent.includes('42 件食材'));
        if (consumedCountEl) {
          consumedCountEl.textContent = `${s.total_consumed ?? 0} 件食材`;
        }

        const wastedCountEl = Array.from(
          document.querySelectorAll('p'),
        ).find((p) => p.textContent.includes('12 件过期'));
        if (wastedCountEl) {
          wastedCountEl.textContent = `${s.total_wasted ?? 0} 件过期`;
        }

        showToast('数据加载成功', 'success');
      } catch (e) {
        console.error(e);
        showToast('加载统计失败', 'error');
      }
    };

    const renderWasteChart = () => {
      const bars = document.querySelectorAll('.bg-slate-50.rounded-t-xl');
      if (!bars.length || !trend.value.length) return;
      const maxAmount = Math.max(
        ...trend.value.map((t) => t.amount),
        1,
      );
      bars.forEach((bar, index) => {
        if (index < trend.value.length) {
          const data = trend.value[index];
          const height = (data.amount / maxAmount) * 100;
          const innerBar = bar.querySelector('.absolute');
          if (innerBar) {
            innerBar.style.height = `${height}%`;
            if (height > 80) {
              innerBar.className =
                'absolute bottom-0 left-0 right-0 bg-coral rounded-t-xl shadow-lg shadow-coral/20';
            } else if (height > 50) {
              innerBar.className =
                'absolute bottom-0 left-0 right-0 bg-coral/60 rounded-t-xl';
            } else {
              innerBar.className =
                'absolute bottom-0 left-0 right-0 bg-coral/40 rounded-t-xl';
            }
          }
        }
      });
    };

    const loadWasteTrend = async () => {
      try {
        const t = await ApiClient.getWasteTrend();
        trend.value = t;
        renderWasteChart();
      } catch (e) {
        console.error(e);
      }
    };

    const renderBadges = () => {
      const container = document.querySelector(
        '.flex.gap-4.overflow-x-auto',
      );
      if (!container) return;
      container.innerHTML = badges.value
        .map(
          (badge) => `
    <div class="flex-shrink-0 w-32 ${
      badge.unlocked
        ? 'bg-teal/5 border border-teal/10'
        : 'bg-white border border-slate-100'
    } p-5 rounded-3xl flex flex-col items-center text-center shadow-sm">
      <div class="w-14 h-14 ${
        badge.unlocked ? 'bg-teal' : 'bg-slate-100'
      } rounded-full flex items-center justify-center mb-4 ${
            badge.unlocked
              ? 'text-white shadow-lg shadow-teal/30'
              : 'text-slate-400'
          }">
        <span class="material-symbols-outlined !text-3xl">${badge.icon}</span>
      </div>
      <p class="text-sm font-bold leading-tight ${
        badge.unlocked ? 'text-slate-900' : 'text-slate-500'
      }">${badge.name}</p>
      ${
        badge.unlocked
          ? `<p class="text-[10px] text-teal font-bold mt-1.5 uppercase">Lvl. ${badge.level}</p>`
          : badge.progress !== undefined
          ? `<div class="w-full h-1 bg-slate-100 rounded-full mt-2.5 overflow-hidden">
            <div class="bg-primary h-full" style="width: ${badge.progress}%"></div>
          </div>`
          : `<p class="text-[10px] text-slate-400 mt-1.5 font-bold uppercase tracking-wider">未解锁</p>`
      }
    </div>
  `,
        )
        .join('');
    };

    const loadBadges = async () => {
      try {
        const list = await ApiClient.getBadges();
        badges.value = list.map((b) => ({
          ...b,
          icon:
            {
              fridge_guardian: 'shield_with_heart',
              clearance_master: 'psychology',
              food_hero: 'eco',
              smart_shopper: 'shopping_basket',
            }[b.id] || 'star',
        }));
        renderBadges();
      } catch (e) {
        console.error(e);
      }
    };

    onMounted(() => {
      loadStats();
      loadWasteTrend();
      loadBadges();

      const backBtn = Array.from(
        document.querySelectorAll('.material-symbols-outlined'),
      ).find((icon) => icon.textContent === 'arrow_back_ios_new')
        ?.parentElement;
      if (backBtn) {
        backBtn.addEventListener('click', () => {
          window.location.href = 'huaileme_home_risk_dashboard_code.html';
        });
      }

      const shareBtn = Array.from(
        document.querySelectorAll('button'),
      ).find((btn) => btn.textContent.includes('分享给朋友'));
      if (shareBtn) {
        shareBtn.addEventListener('click', () => {
          showToast('分享功能开发中...', 'info');
        });
      }

      const homeBtn = Array.from(
        document.querySelectorAll('.material-symbols-outlined'),
      ).find((icon) => icon.textContent === 'home')?.parentElement;
      if (homeBtn) {
        homeBtn.addEventListener('click', () => {
          window.location.href = 'huaileme_home_risk_dashboard_code.html';
        });
      }
    });

    return {};
  },
}).mount(document.body);

// 显示提示消息
function showToast(message, type = 'info') {
  const toast = document.createElement('div');
  toast.className = `fixed top-20 left-1/2 -translate-x-1/2 z-[100] px-6 py-3 rounded-full text-white text-sm font-bold shadow-lg transition-all transform translate-y-0 opacity-100`;
  
  const colors = {
    success: 'bg-primary',
    error: 'bg-red-500',
    info: 'bg-blue-500'
  };
  
  toast.classList.add(colors[type] || colors.info);
  toast.textContent = message;
  document.body.appendChild(toast);
  
  setTimeout(() => {
    toast.style.transform = 'translateY(-20px)';
    toast.style.opacity = '0';
    setTimeout(() => toast.remove(), 300);
  }, 2000);
}
</script>
<nav class="sticky top-0 z-50 bg-white/90 backdrop-blur-md px-4 py-4 flex items-center justify-between border-b border-slate-100">
<button class="w-10 h-10 flex items-center justify-center rounded-full active:bg-slate-100 transition-colors">
<span class="material-symbols-outlined text-slate-700">arrow_back_ios_new</span>
</button>
<h1 class="text-[19px] font-bold tracking-normal">我的零浪费记录</h1>
<button class="w-10 h-10 flex items-center justify-center rounded-full active:bg-slate-100 transition-colors">
<span class="material-symbols-outlined text-slate-700">calendar_today</span>
</button>
</nav>
<main class="max-w-md mx-auto pb-32">
<section class="px-6 pt-10 pb-6 text-center">
<div class="relative w-56 h-28 mx-auto mb-6 overflow-hidden">
<div class="absolute inset-0 border-[16px] border-slate-100 rounded-t-full"></div>
<div class="absolute inset-0 border-[16px] border-primary rounded-t-full" style="clip-path: inset(0 0 0 0); transform: rotate(165deg); transform-origin: center bottom;"></div>
<div class="absolute bottom-0 left-0 right-0">
<span class="text-5xl font-extrabold text-slate-900 leading-none">92</span>
<span class="text-sm font-bold text-slate-400 block mt-1 tracking-tight">环保小达人</span>
</div>
</div>
<h2 class="text-2xl font-black text-slate-900 tracking-tight mb-2">简直太棒啦！</h2>
<p class="text-slate-500 text-sm font-medium">这个月你打败了 95% 的小伙伴哦。</p>
</section>
<section class="grid grid-cols-2 gap-4 px-4 py-2">
<div class="bg-white border border-slate-100 shadow-sm p-5 rounded-2xl">
<p class="text-xs font-bold text-slate-400 tracking-tight mb-1">省下了这么多</p>
<div class="flex items-baseline gap-1">
<span class="text-2xl font-bold text-teal">¥845</span>
<span class="text-[11px] font-bold text-teal bg-teal/10 px-1.5 py-0.5 rounded">+12%</span>
</div>
</div>
<div class="bg-white border border-slate-100 shadow-sm p-5 rounded-2xl">
<p class="text-xs font-bold text-slate-400 tracking-tight mb-1">不小心浪费了</p>
<div class="flex items-baseline gap-1">
<span class="text-2xl font-bold text-coral">4 件</span>
<span class="text-[11px] font-bold text-coral bg-coral/10 px-1.5 py-0.5 rounded">-2%</span>
</div>
</div>
</section>
<section class="px-4 py-4">
<div class="bg-white border border-slate-100 shadow-sm p-6 rounded-3xl">
<h3 class="text-lg font-bold text-slate-900 mb-6">吃掉了 vs 扔掉了</h3>
<div class="flex items-center gap-8">
<div class="relative w-32 h-32 flex items-center justify-center">
<div class="chart-ring absolute inset-0"></div>
<div class="absolute inset-4 bg-white rounded-full flex flex-col items-center justify-center shadow-inner">
<span class="text-2xl font-extrabold text-slate-900">78%</span>
<span class="text-[10px] font-bold text-slate-400 tracking-tighter">光盘啦</span>
</div>
</div>
<div class="flex flex-col gap-5 flex-1">
<div class="flex items-center gap-3">
<div class="w-3.5 h-3.5 rounded-full bg-primary shadow-sm shadow-primary/40"></div>
<div class="flex-1">
<p class="text-sm font-bold leading-none text-slate-800">进肚子的</p>
<p class="text-xs text-slate-400 font-medium">42 件食材</p>
</div>
</div>
<div class="flex items-center gap-3">
<div class="w-3.5 h-3.5 rounded-full bg-coral shadow-sm shadow-coral/40"></div>
<div class="flex-1">
<p class="text-sm font-bold leading-none text-slate-800">扔掉的</p>
<p class="text-xs text-slate-400 font-medium">12 件过期</p>
</div>
</div>
</div>
</div>
</div>
</section>
<section class="px-4 py-4">
<div class="bg-white border border-slate-100 shadow-sm p-6 rounded-3xl">
<div class="flex justify-between items-start mb-8">
<div>
<h3 class="text-lg font-bold text-slate-900">钱包心疼指数</h3>
<p class="text-sm text-slate-400 font-medium">最近浪费的钱</p>
</div>
<div class="text-right">
<span class="text-coral font-extrabold text-2xl">¥286.50</span>
</div>
</div>
<div class="flex items-end justify-between h-36 gap-3 px-1">
<div class="flex-1 bg-slate-50 rounded-t-xl relative h-1/2">
<div class="absolute bottom-0 left-0 right-0 bg-coral/20 rounded-t-xl" style="height: 100%"></div>
</div>
<div class="flex-1 bg-slate-50 rounded-t-xl relative h-3/4">
<div class="absolute bottom-0 left-0 right-0 bg-coral/40 rounded-t-xl" style="height: 100%"></div>
</div>
<div class="flex-1 bg-slate-50 rounded-t-xl relative h-1/3">
<div class="absolute bottom-0 left-0 right-0 bg-coral/20 rounded-t-xl" style="height: 100%"></div>
</div>
<div class="flex-1 bg-slate-50 rounded-t-xl relative h-full">
<div class="absolute bottom-0 left-0 right-0 bg-coral rounded-t-xl shadow-lg shadow-coral/20" style="height: 100%"></div>
</div>
<div class="flex-1 bg-slate-50 rounded-t-xl relative h-2/3">
<div class="absolute bottom-0 left-0 right-0 bg-coral/60 rounded-t-xl" style="height: 100%"></div>
</div>
<div class="flex-1 bg-slate-50 rounded-t-xl relative h-1/2">
<div class="absolute bottom-0 left-0 right-0 bg-coral/40 rounded-t-xl" style="height: 100%"></div>
</div>
</div>
<div class="flex justify-between mt-4 px-1">
<span class="text-[10px] font-bold text-slate-400">5月</span>
<span class="text-[10px] font-bold text-slate-400">6月</span>
<span class="text-[10px] font-bold text-slate-400">7月</span>
<span class="text-[10px] font-bold text-slate-400">8月</span>
<span class="text-[10px] font-bold text-slate-400">9月</span>
<span class="text-[10px] font-bold text-slate-400">10月</span>
</div>
</div>
</section>
<section class="py-6">
<h3 class="text-lg font-bold px-5 mb-4 text-slate-900">我的荣誉勋章</h3>
<div class="flex gap-4 overflow-x-auto px-5 no-scrollbar pb-4">
<div class="flex-shrink-0 w-32 bg-teal/5 border border-teal/10 p-5 rounded-3xl flex flex-col items-center text-center shadow-sm">
<div class="w-14 h-14 bg-teal rounded-full flex items-center justify-center mb-4 text-white shadow-lg shadow-teal/30">
<span class="material-symbols-outlined !text-3xl">shield_with_heart</span>
</div>
<p class="text-sm font-bold leading-tight text-slate-900">冰箱守护者</p>
<p class="text-[10px] text-teal font-bold mt-1.5 uppercase">Lvl. 4</p>
</div>
<div class="flex-shrink-0 w-32 bg-white border border-slate-100 p-5 rounded-3xl flex flex-col items-center text-center shadow-sm">
<div class="w-14 h-14 bg-slate-100 rounded-full flex items-center justify-center mb-4 text-slate-400">
<span class="material-symbols-outlined !text-3xl">psychology</span>
</div>
<p class="text-sm font-bold leading-tight text-slate-500">清仓小能手</p>
<p class="text-[10px] text-slate-400 mt-1.5 font-bold uppercase tracking-wider">未解锁</p>
</div>
<div class="flex-shrink-0 w-32 bg-white border border-slate-100 p-5 rounded-3xl flex flex-col items-center text-center shadow-sm">
<div class="w-14 h-14 bg-slate-100 rounded-full flex items-center justify-center mb-4 text-slate-400">
<span class="material-symbols-outlined !text-3xl">eco</span>
</div>
<p class="text-sm font-bold leading-tight text-slate-500">节粮小英雄</p>
<div class="w-full h-1 bg-slate-100 rounded-full mt-2.5 overflow-hidden">
<div class="bg-primary h-full w-[80%]"></div>
</div>
</div>
<div class="flex-shrink-0 w-32 bg-white border border-slate-100 p-5 rounded-3xl flex flex-col items-center text-center shadow-sm">
<div class="w-14 h-14 bg-slate-100 rounded-full flex items-center justify-center mb-4 text-slate-400">
<span class="material-symbols-outlined !text-3xl">shopping_basket</span>
</div>
<p class="text-sm font-bold leading-tight text-slate-500">精明小买手</p>
<p class="text-[10px] text-slate-400 mt-1.5">12/20 项</p>
</div>
</div>
</section>
</main>
<div class="fixed bottom-24 left-0 right-0 px-6 max-w-md mx-auto z-40">
<button class="w-full bg-primary text-white font-extrabold py-4 rounded-2xl shadow-xl shadow-primary/20 active:scale-[0.98] transition-all flex items-center justify-center gap-2">
<span class="material-symbols-outlined">share</span>
            把好成绩分享给朋友
        </button>
</div>
<div class="fixed bottom-0 left-0 w-full px-5 pb-8 bg-gradient-to-t from-background via-background/95 to-transparent pt-12 z-50">
<div class="max-w-md mx-auto relative flex items-center justify-between px-6 py-4 bg-white/80 backdrop-blur-2xl rounded-full border border-white/40 shadow-[0_20px_50px_rgba(0,0,0,0.1)]">
<div class="flex flex-col items-center gap-1 cursor-pointer" onclick="window.location.href='huaileme_home_risk_dashboard_code.html'" style="cursor: pointer;">
<span class="material-symbols-outlined text-slate-400 font-bold">home</span>
<span class="text-[10px] font-black text-slate-400">首页</span>
</div>
<div class="flex flex-col items-center gap-1 text-primary cursor-pointer" onclick="window.location.href='zero_waste_statistics_report_code.html'" style="cursor: pointer;">
<span class="material-symbols-outlined text-[24px] font-variation-settings:'FILL' 1">savings</span>
<span class="text-[10px] font-bold">统计</span>
</div>
<div class="absolute left-1/2 -translate-x-1/2 -top-10">
<button class="size-16 rounded-full bg-primary text-white shadow-[0_15px_35px_rgba(19,236,128,0.5)] flex items-center justify-center border-[5px] border-white active:scale-90 transition-all duration-200" onclick="window.location.href='ai_smart_scanner_entry_code.html'" style="cursor: pointer;">
<span class="material-symbols-outlined text-3xl font-bold">qr_code_scanner</span>
</button>
<span class="absolute -bottom-7 left-1/2 -translate-x-1/2 text-[10px] font-black text-slate-400 w-max">扫一扫</span>
</div>
<div class="w-8"></div> 
<div class="flex flex-col items-center gap-1 text-slate-400 cursor-pointer hover:text-slate-600 transition-colors" onclick="window.location.href='ai_fridge_clearing_recipes_code.html'" style="cursor: pointer;">
<span class="material-symbols-outlined text-[24px]">restaurant_menu</span>
<span class="text-[10px] font-bold">菜谱</span>
</div>
<div class="flex flex-col items-center gap-1 text-slate-400 cursor-pointer hover:text-slate-600 transition-colors" onclick="window.location.href='user_family_center_code.html'" style="cursor: pointer;">
<span class="material-symbols-outlined text-[24px]">face</span>
<span class="text-[10px] font-bold">设置</span>
</div>
</div>
</div>

</body></html>