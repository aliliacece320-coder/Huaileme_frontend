<!DOCTYPE html>
<html class="light" lang="zh-CN"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>坏了么 - AI 智能扫码录入 (圆体中文版)</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&amp;family=ZCOOL+KuaiLe&amp;family=Ma+Shan+Zheng&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#13ec80",
                        "background-light": "#f6f8f7",
                        "background-dark": "#0a1510",
                        "surface-glass": "rgba(255, 255, 255, 0.75)",
                    },
                    fontFamily: {
                        "display": ["'Rounded Mplus 1c'", "'PingFang SC'", "'Heiti SC'", "system-ui", "sans-serif"]
                    },
                    borderRadius: {"DEFAULT": "0.5rem", "lg": "1rem", "xl": "1.5rem", "full": "9999px"},
                },
            },
        }
    </script>
<style type="text/tailwindcss">
        @layer base {body {
                font-family: "PingFang SC", "Quicksand", "Microsoft YaHei", sans-serif;
                -webkit-font-smoothing: antialiased;
            }
            .font-rounded {
                font-family: "Quicksand", "PingFang SC", "Heiti SC", sans-serif;
                font-weight: 600;
            }
        }
        .camera-overlay {
            background: radial-gradient(circle, transparent 40%, rgba(255, 255, 255, 0.4) 100%);
        }
        .scan-ring {
            box-shadow: 0 0 20px 2px rgba(19, 236, 128, 0.4);
        }
        .frosted-glass {
            @apply backdrop-blur-xl bg-white/70 border-white/40;
        }* {
            letter-spacing: -0.01em;
        }
    </style>
<style>
        body {
            min-height: max(884px, 100dvh);border-radius: 40px;
        }
    </style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
  </head>
<body class="bg-background-light font-display text-slate-900 overflow-hidden h-screen flex flex-col">
<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
<script src="/public/api-client.js"></script>
<script>
const { createApp, ref, onMounted } = Vue;

createApp({
  setup() {
    const recognizedFood = ref(null);
    const isScanning = ref(false);

    const updateScanResult = (result) => {
      const nameSpans = Array.from(document.querySelectorAll('span'));
      const nameSpan = nameSpans.find((s) =>
        s.textContent.includes('希腊酸奶') || s.textContent.includes('酸奶'),
      );
      if (nameSpan) {
        nameSpan.textContent = result.name;
      }

      const expiryEl = Array.from(document.querySelectorAll('p')).find((p) =>
        p.textContent.includes('2026/05/20') || p.textContent.includes('啥时候过期'),
      );
      if (expiryEl) {
        const dateText = result.expireDate || result.expiry_date;
        expiryEl.textContent = dateText;
      }

      const daysEl = Array.from(document.querySelectorAll('p')).find(
        (p) => p.textContent.includes('天') && p.textContent.includes('还能吃多久'),
      );
      if (daysEl) {
        const dateStr = result.expireDate || result.expiry_date;
        if (dateStr) {
          const days = Math.ceil(
            (new Date(dateStr) - new Date()) / (1000 * 60 * 60 * 24),
          );
          daysEl.textContent = `${days} 天`;
        }
      }

      recognizedFood.value = result;
    };

    const simulateScan = async () => {
      try {
        showLoading('正在识别...');
        const result = await ApiClient.recognizeFood({
          imageUrl: '',
        });
        updateScanResult(result);
        hideLoading();
        showToast('识别成功！', 'success');
      } catch (e) {
        console.error(e);
        hideLoading();
        showToast('识别失败，请重试', 'error');
      }
    };

    const startScan = () => {
      if (isScanning.value) return;
      isScanning.value = true;
      showToast('请将摄像头对准食物', 'info');
      setTimeout(async () => {
        await simulateScan();
        isScanning.value = false;
      }, 2000);
    };

    const startBarcodeScan = () => {
      if (isScanning.value) return;
      isScanning.value = true;
      showToast('请扫描条形码', 'info');
      setTimeout(async () => {
        await simulateScan();
        isScanning.value = false;
      }, 1500);
    };

    const saveFood = async () => {
      if (!recognizedFood.value) {
        showToast('请先识别食物', 'error');
        return;
      }
      const activeBtn = document.querySelector(
        'button.border-2.border-primary.bg-primary',
      );
      const text = activeBtn?.textContent.trim() || '冷藏';
      let storageStatus = 'fridge';
      if (text === '常温') storageStatus = 'room';
      else if (text === '冷冻') storageStatus = 'freezer';

      try {
        showLoading('正在保存...');
        await ApiClient.saveScannedFood({
          name: recognizedFood.value.name,
          expireDate:
            recognizedFood.value.expireDate ||
            recognizedFood.value.expiry_date,
          storageStatus,
          brand: recognizedFood.value.brand || '',
          category: recognizedFood.value.category || '',
          imageUrl: recognizedFood.value.image_url || '',
        });
        hideLoading();
        showToast('保存成功！', 'success');
        setTimeout(() => {
          window.location.href = 'huaileme_home_risk_dashboard_code.html';
        }, 1500);
      } catch (e) {
        console.error(e);
        hideLoading();
        showToast('保存失败，请重试', 'error');
      }
    };

    onMounted(() => {
      // 关闭按钮
      const closeIcon = document.querySelector('.material-symbols-outlined');
      if (closeIcon && closeIcon.parentElement) {
        closeIcon.parentElement.addEventListener('click', () => {
          window.location.href = 'huaileme_home_risk_dashboard_code.html';
        });
      }

      const saveBtn = Array.from(document.querySelectorAll('button')).find((btn) =>
        btn.textContent.includes('记下来'),
      );
      if (saveBtn) {
        saveBtn.addEventListener('click', saveFood);
      }

      const cameraBtn = Array.from(document.querySelectorAll('button')).find(
        (btn) =>
          btn.querySelector('.material-symbols-outlined')?.textContent ===
          'camera',
      );
      if (cameraBtn) {
        cameraBtn.addEventListener('click', startScan);
      }

      const barcodeBtn = Array.from(document.querySelectorAll('button')).find(
        (btn) =>
          btn.querySelector('.material-symbols-outlined')?.textContent ===
          'barcode_scanner',
      );
      if (barcodeBtn) {
        barcodeBtn.addEventListener('click', startBarcodeScan);
      }

      document.querySelectorAll('button').forEach((btn) => {
        const text = btn.textContent.trim();
        if (text === '常温' || text === '冷藏' || text === '冷冻') {
          btn.addEventListener('click', () => {
            document.querySelectorAll('button').forEach((b) => {
              const bText = b.textContent.trim();
              if (bText === '常温' || bText === '冷藏' || bText === '冷冻') {
                b.classList.remove(
                  'border-2',
                  'border-primary',
                  'bg-primary',
                  'text-white',
                  'shadow-lg',
                  'shadow-primary/20',
                );
                b.classList.add(
                  'border',
                  'border-slate-200',
                  'bg-white',
                  'text-slate-400',
                );
              }
            });
            btn.classList.remove(
              'border',
              'border-slate-200',
              'bg-white',
              'text-slate-400',
            );
            btn.classList.add(
              'border-2',
              'border-primary',
              'bg-primary',
              'text-white',
              'shadow-lg',
              'shadow-primary/20',
            );
          });
        }
      });

      // 初始模拟一次识别
      simulateScan();
    });

    // 暴露到 window 以便调试（可选）
    window._scanner = { startScan, startBarcodeScan, saveFood };

    return {};
  },
}).mount(document.body);

// 显示加载状态
function showLoading(message) {
  let loader = document.getElementById('loading-overlay');
  if (!loader) {
    loader = document.createElement('div');
    loader.id = 'loading-overlay';
    loader.className = 'fixed inset-0 bg-black/50 z-[200] flex items-center justify-center';
    loader.innerHTML = `
      <div class="bg-white rounded-2xl p-6 flex flex-col items-center gap-4">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
        <p class="text-slate-800 font-bold">${message}</p>
      </div>
    `;
    document.body.appendChild(loader);
  }
}

function hideLoading() {
  const loader = document.getElementById('loading-overlay');
  if (loader) loader.remove();
}

// 显示提示消息
function showToast(message, type = 'info') {
  const toast = document.createElement('div');
  toast.className = `fixed top-20 left-1/2 -translate-x-1/2 z-[100] px-6 py-3 rounded-full text-white text-sm font-bold shadow-lg transition-all transform translate-y-0 opacity-100`;
  
  const colors = {
    success: 'bg-primary',
    error: 'bg-red-500',
    info: 'bg-blue-500'
  };
  
  toast.classList.add(colors[type] || colors.info);
  toast.textContent = message;
  document.body.appendChild(toast);
  
  setTimeout(() => {
    toast.style.transform = 'translateY(-20px)';
    toast.style.opacity = '0';
    setTimeout(() => toast.remove(), 300);
  }, 2000);
}
</script>
<div class="relative z-50 flex items-center bg-transparent p-4 pb-2 justify-between">
<div class="text-slate-900 flex size-12 shrink-0 items-center">
<div class="p-2 rounded-full bg-white/60 backdrop-blur-md">
<span class="material-symbols-outlined cursor-pointer">close</span>
</div>
</div>
<h2 class="text-slate-900 text-lg font-bold leading-tight tracking-tight flex-1 text-center drop-shadow-sm font-rounded">AI 智能扫码录入</h2>
<div class="flex w-12 items-center justify-end">
<button class="flex size-12 cursor-pointer items-center justify-center rounded-full bg-white/60 backdrop-blur-md text-slate-900 shadow-sm">
<span class="material-symbols-outlined">flashlight_on</span>
</button>
</div>
</div>
<div class="relative flex-1 flex flex-col items-center justify-center overflow-hidden">
<div class="absolute inset-0 z-0">
<img alt="食品保质期扫描" class="w-full h-full object-cover contrast-[1.05]" src="https://lh3.googleusercontent.com/aida-public/AB6AXuArYRimNecEj3W2aQgoRRC-kbu1-xklMJZm8nvkkXuf5X7A-K3ctvw4DnZ28L6vuTwFvfZc9s7gYcN0ZhOXYuZ4_91qzytjaiIZSj_crseLgipozF8itBSa6upkCACsmvASvljuX9xzm670dLtNdShuC2aYbcIYd4vXTTay68lZxB03jsGYIYm1YPYkBJW2gOdau5_cmbUoqxj0COSDOaUeuRBBvoBOYgA4tYvuDh4qp-OYT_orfirnU1LwSeD9h1l9Jsux25fZ_nUK"/>
<div class="absolute inset-0 camera-overlay"></div>
</div>
<div class="relative z-10 flex flex-col items-center">
<div class="w-48 h-48 border-4 border-primary rounded-full scan-ring flex items-center justify-center relative">
<div class="absolute inset-0 border border-primary/40 rounded-full scale-110"></div>
<div class="absolute top-0 left-0 w-6 h-6 border-t-4 border-l-4 border-primary rounded-tl-full -translate-x-4 -translate-y-4"></div>
<div class="absolute top-0 right-0 w-6 h-6 border-t-4 border-r-4 border-primary rounded-tr-full translate-x-4 -translate-y-4"></div>
<div class="absolute bottom-0 left-0 w-6 h-6 border-b-4 border-l-4 border-primary rounded-bl-full -translate-x-4 translate-y-4"></div>
<div class="absolute bottom-0 right-0 w-6 h-6 border-b-4 border-r-4 border-primary rounded-br-full translate-x-4 translate-y-4"></div>
</div>
<div class="mt-8 flex gap-3 p-1">
<div class="flex h-12 shrink-0 items-center justify-center gap-x-2 rounded-2xl bg-white/80 backdrop-blur-md px-5 border border-white/50 shadow-xl">
<span class="material-symbols-outlined text-primary font-bold">verified</span>
<p class="text-slate-900 text-base font-bold leading-normal font-rounded">发现日期：2026/05/20</p>
</div>
</div>
<p class="text-slate-700 text-sm font-semibold leading-normal mt-4 bg-white/60 backdrop-blur-md px-6 py-2 rounded-full border border-white/40 shadow-sm font-rounded">
                请将保质期对准圆圈中心
            </p>
</div>
<div class="absolute right-6 top-1/2 -translate-y-12 z-20 flex flex-col gap-5">
<button class="flex items-center justify-center rounded-full size-12 bg-white/70 backdrop-blur-md border border-white/50 text-slate-800 shadow-md">
<span class="material-symbols-outlined">history</span>
</button>
<button class="flex items-center justify-center rounded-full size-12 bg-white/70 backdrop-blur-md border border-white/50 text-primary shadow-md">
<span class="material-symbols-outlined" style="font-variation-settings: 'FILL' 1">auto_awesome</span>
</button>
</div>
</div>
<div class="relative z-10 flex items-center justify-center gap-8 p-4 pb-6">
<button class="flex shrink-0 items-center justify-center rounded-full size-12 bg-white/60 backdrop-blur-md text-slate-700 border border-white/50">
<span class="material-symbols-outlined">image</span>
</button>
<button class="flex shrink-0 items-center justify-center rounded-full size-20 bg-primary/20 border-4 border-white/80 p-1 shadow-lg">
<div class="bg-primary rounded-full w-full h-full flex items-center justify-center shadow-inner">
<span class="material-symbols-outlined text-white font-bold text-3xl">camera</span>
</div>
</button>
<button class="flex shrink-0 items-center justify-center rounded-full size-12 bg-white/60 backdrop-blur-md text-slate-700 border border-white/50">
<span class="material-symbols-outlined">barcode_scanner</span>
</button>
</div>
<div class="relative z-[60] flex flex-col justify-end items-stretch">
<div class="flex flex-col items-stretch bg-white/80 backdrop-blur-2xl rounded-t-[40px] border-t border-white/60 pb-10 px-6 shadow-[0_-10px_40px_rgba(0,0,0,0.05)]">
<button class="flex h-10 w-full items-center justify-center">
<div class="h-1.5 w-14 rounded-full bg-slate-200"></div>
</button>
<div class="space-y-6 pt-2">
<div class="flex items-center justify-between">
<div>
<h3 class="text-[11px] font-extrabold text-primary uppercase tracking-widest mb-1 font-rounded">这是什么？</h3>
<div class="flex items-center gap-2">
<span class="material-symbols-outlined text-primary" style="font-variation-settings: 'FILL' 1">lunch_dining</span>
<span class="text-2xl font-bold text-slate-900 tracking-tight font-rounded">希腊酸奶 - 有机</span>
</div>
</div>
<button class="p-2.5 rounded-2xl bg-slate-100/80 text-slate-500 border border-slate-200/50">
<span class="material-symbols-outlined text-xl">edit_note</span>
</button>
</div>
<div class="grid grid-cols-2 gap-4">
<div class="bg-slate-50/80 p-4 rounded-[24px] border border-slate-100">
<p class="text-[11px] text-slate-400 font-bold mb-1 tracking-wider font-rounded">啥时候过期？</p>
<p class="text-lg font-bold text-slate-900 font-rounded">2026/05/20</p>
</div>
<div class="bg-primary/5 p-4 rounded-[24px] border border-primary/10">
<p class="text-[11px] text-primary/70 font-bold mb-1 tracking-wider font-rounded">还能吃多久</p>
<p class="text-lg font-bold text-slate-900 font-rounded">450 天</p>
</div>
</div>
<div>
<p class="text-[11px] text-slate-400 font-bold mb-3 tracking-wider font-rounded">住哪儿？（常温/冷藏/冷冻）</p>
<div class="flex gap-2">
<button class="flex-1 flex flex-col items-center justify-center gap-1.5 p-3.5 rounded-[22px] border border-slate-200 bg-white text-slate-400">
<span class="material-symbols-outlined">thermostat</span>
<span class="text-[11px] font-bold font-rounded">常温</span>
</button>
<button class="flex-1 flex flex-col items-center justify-center gap-1.5 p-3.5 rounded-[22px] border-2 border-primary bg-primary text-white shadow-lg shadow-primary/20">
<span class="material-symbols-outlined" style="font-variation-settings: 'FILL' 1">kitchen</span>
<span class="text-[11px] font-bold font-rounded">冷藏</span>
</button>
<button class="flex-1 flex flex-col items-center justify-center gap-1.5 p-3.5 rounded-[22px] border border-slate-200 bg-white text-slate-400">
<span class="material-symbols-outlined">ac_unit</span>
<span class="text-[11px] font-bold font-rounded">冷冻</span>
</button>
</div>
</div>
<button class="w-full h-15 py-4 bg-primary text-white font-bold text-lg rounded-[22px] flex items-center justify-center gap-3 shadow-xl shadow-primary/25 active:scale-95 transition-transform font-rounded">
<span class="material-symbols-outlined font-bold">save_as</span>
                    记下来
                </button>
</div>
</div>
</div>

</body></html>